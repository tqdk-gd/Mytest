<!DOCTYPE html>
<html>
<head>
    <title>å®‰å…¨æ‰«ææŠ¥å‘Š - {{ target }}</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --primary-color: #2c3e50;
            --secondary-color: #3498db;
        }
        body { font-family: Segoe UI, sans-serif; margin: 40px; }
        .card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .directory-tree ul { padding-left: 25px; list-style: none; }
        .directory-tree li { position: relative; padding: 5px 0; }
        .directory-tree li::before {
            content: 'ğŸ“„';
            position: absolute;
            left: -25px;
        }
        .directory-tree li[data-folder]::before { content: 'ğŸ“'; }
        table { width: 100%; border-collapse: collapse; }
        th, td { padding: 12px; text-align: left; border-bottom: 1px solid #ddd; }
        tr:nth-child(even) { background-color: #f9f9f9; }
        .severity-critical { color: #e74c3c; font-weight: bold; }
        .severity-high { color: #e67e22; }
        .severity-medium { color: #f1c40f; }
        .severity-low { color: #2ecc71; }
    </style>
</head>
<body>
    <h1 style="color: var(--primary-color);">Webå®‰å…¨æ‰«ææŠ¥å‘Š</h1>
    <h2 style="color: var(--secondary-color);">ç›®æ ‡ç½‘ç«™: {{ target }}</h2>

    <div class="card">
        <h3>ğŸ“‚ ç›®å½•ç»“æ„åˆ†æ</h3>
        <div class="directory-tree">
            {% macro render_tree(node) %}
                <ul>
                {% for key, value in node.items() %}
                    <li {% if value %}data-folder{% endif %}>
                        {{ key }}
                        {{ render_tree(value) if value }}
                    </li>
                {% endfor %}
                </ul>
            {% endmacro %}
            {{ render_tree(directory_tree) }}
        </div>
    </div>

    <div class="card">
        <h3>ğŸ“Š èµ„äº§ç»Ÿè®¡</h3>
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
            <div>
                <canvas id="subdomainChart"></canvas>
                <p>å‘ç°æœ‰æ•ˆå­åŸŸå: {{ assets.subdomain_count }}</p>
            </div>
            <div>
                <canvas id="filetypeChart"></canvas>
            </div>
        </div>
    </div>

    <div class="card">
        <h3>ğŸš¨ æ¼æ´æ€»è§ˆ</h3>
        <div style="height: 400px;">
            <canvas id="vulnerabilityChart"></canvas>
        </div>
    </div>

    <div class="card">
        <h3>ğŸ“ æ¼æ´è¯¦æƒ…</h3>
        <table>
            <thead>
                <tr>
                    <th>ä¸¥é‡ç­‰çº§</th>
                    <th>æ¼æ´åç§°</th>
                    <th>URLåœ°å€</th>
                    <th>æè¿°</th>
                </tr>
            </thead>
            <tbody>
                {% for severity in ['critical', 'high', 'medium', 'low'] %}
                    {% for vuln in vulnerabilities[severity] %}
                    <tr>
                        <td class="severity-{{ severity }}">{{ vuln.severity | upper }}</td>
                        <td>{{ vuln.name }}</td>
                        <td><a href="{{ vuln.url }}" target="_blank">{{ vuln.url }}</a></td>
                        <td>{{ vuln.description[:60] }}...</td>
                    </tr>
                    {% endfor %}
                {% endfor %}
            </tbody>
        </table>
    </div>

<script>
// å­åŸŸåç»Ÿè®¡å›¾è¡¨
new Chart(document.getElementById('subdomainChart'), {
    type: 'doughnut',
    data: {
        labels: ['å­˜æ´»å­åŸŸå', 'æ€»æ•°'],
        datasets: [{
            data: [{{ assets.subdomain_count }}, {{ assets.urls | length }}],
            backgroundColor: ['#3498db', '#2ecc71']
        }]
    }
});

// æ–‡ä»¶ç±»å‹å›¾è¡¨
new Chart(document.getElementById('filetypeChart'), {
    type: 'bar',
    data: {
        labels: {{ assets.file_types.keys() | list | tojson }},
        datasets: [{
            label: 'æ–‡ä»¶ç±»å‹åˆ†å¸ƒ',
            data: {{ assets.file_types.values() | list | tojson }},
            backgroundColor: '#e67e22'
        }]
    }
});

// æ¼æ´å›¾è¡¨
new Chart(document.getElementById('vulnerabilityChart'), {
    type: 'radar',
    data: {
        labels: ['Critical', 'High', 'Medium', 'Low'],
        datasets: [{
            label: 'æ¼æ´ä¸¥é‡ç¨‹åº¦åˆ†å¸ƒ',
            data: [
                {{ vulnerabilities.critical | count }},
                {{ vulnerabilities.high | count }},
                {{ vulnerabilities.medium | count }},
                {{ vulnerabilities.low | count }}
            ],
            backgroundColor: 'rgba(231, 76, 60, 0.2)',
            borderColor: '#e74c3c'
        }]
    },
    options: { 
        scales: { r: { beginAtZero: true, max: {{ vulnerabilities.values() | map('length') | max }} } }
    }
});
</script>
</body>
</html>
